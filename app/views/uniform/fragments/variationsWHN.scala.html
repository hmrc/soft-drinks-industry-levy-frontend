@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import sdil.models.variations.RegistrationVariationData
@import sdil.models.ReturnPeriod
@import java.time.LocalDate
@import views.html.softdrinksindustrylevy.helpers._

@(v: Option[RegistrationVariationData] = None, key: Option[String] = None)(implicit messages: Messages)


@formatLitres(value: BigDecimal) = @{
    java.text.NumberFormat.getNumberInstance.format(value)
}

@v.map { v =>
    @v.deregDate.map { deregDate =>
        <p>
            @Messages(
                "dereg.what-happens-next.p1",
                ReturnPeriod(deregDate).start.format("MMMM yyyy"),
                ReturnPeriod(deregDate).end.format("MMMM yyyy")
            )
        </p>
        <div class="panel panel-border-wide">
            <p>
            @Messages(
                "dereg.what-happens-next.p2",
                ReturnPeriod(deregDate).deadline.withDayOfMonth(1).format("d MMMM"),
                ReturnPeriod(deregDate).deadline.format("d MMMM yyyy")
            )
            </p>
        </div>
        <p>@Messages("dereg.what-happens-next.p3")</p>
    }

@if(key.nonEmpty) {
    @key.map { x =>
        <p>@Html(Messages(s"$x.variationDone.what-happens-next"))</p>
    }
} else {
    <p>@Messages("variationDone.what-happens-next")</p>
}

@Html(Messages("return-sent.servicePage", sdil.controllers.routes.ServicePageController.show()))



@details(Messages("summary.variation.title")) {
        <h2 class="heading-medium">
        @Messages("variations.cya.activity-change")
        </h2>
        <table class="check-your-answers">
            <tbody>

                <tr>
                    <td class="cya-question">
                    @Messages("variations.cya.activity-change.producer")
                    </td>
                    <td>
                        @Messages(s"variations.cya.${v.producer.isProducer}")
                        @if(v.producer.isProducer) {
                            @v.producer.isLarge.map {
                                case true => {
                                    : @Messages("sdil.declaration.largeProducer")
                                }
                                case _ => {
                                    : @Messages("sdil.declaration.smallProducer")
                    }
                    }
                    }
                    </td>
                </tr>

                @if(v.usesCopacker.isDefined) {
                    <tr>
                        <td class="cya-question">
                        @Messages("variations.cya.activity-change.use-copacker")
                        </td>
                        <td>
                        @v.usesCopacker.map { x =>
                            @Messages(s"variations.cya.$x")
                        }
                        </td>
                    </tr>
                }

                <tr>
                    <td class="cya-question">
                    @Messages("variations.cya.activity-change.package-own")
                    </td>
                    <td>
                    @v.packageOwn.map { x =>
                        @Messages(s"variations.cya.$x")
                    }
                    </td>
                </tr>

                @if(v.packageOwn.getOrElse(false)) {
                    <tr>
                        <td class="cya-question">
                        @Messages("variations.cya.activity-change.litres-own")
                        </td>

                        @v.packageOwnVol.map { x =>
                        <td>
                            @Messages("variations.cya.activity-change.low-band")
                            @formatLitres(x.atLowRate) <br/>
                        @Messages("variations.cya.activity-change.high-band")
                        @formatLitres(x.atHighRate)
                        </td>
                        }
                    </tr>
                }

                <tr>
                    <td class="cya-question">
                    @Messages("variations.cya.activity-change.package-others")
                    </td>
                    <td>
                    @Messages(s"variations.cya.${v.copackForOthers}")
                    </td>
                </tr>

                @if(v.copackForOthers) {
                    <tr>
                        <td class="cya-question">
                        @Messages("variations.cya.activity-change.litres-others")
                        </td>
                        @v.copackForOthersVol.map { x =>
                        <td>
                            @Messages("variations.cya.activity-change.low-band")
                            @formatLitres(x.atLowRate) <br/>
                        @Messages("variations.cya.activity-change.high-band")
                        @formatLitres(x.atHighRate)
                        </td>
                        }
                    </tr>
                }

                <tr>
                    <td class="cya-question">
                    @Messages("variations.cya.activity-change.import")
                    </td>
                    <td>
                    @Messages(s"variations.cya.${v.imports}")
                    <td/>
                </tr>

                @if(v.imports) {
                    <tr>
                        <td class="cya-question">
                        @Messages("variations.cya.activity-change.litres-import")
                        </td>
                        <td>
                        @v.importsVol.map { x =>
                            @Messages("variations.cya.activity-change.low-band")
                            @formatLitres(x.atLowRate) <br/>
                        @Messages("variations.cya.activity-change.high-band")
                        @formatLitres(x.atHighRate)
                        }
                        <td/>
                    </tr>
                }

            </tbody>
        </table>

    }
}