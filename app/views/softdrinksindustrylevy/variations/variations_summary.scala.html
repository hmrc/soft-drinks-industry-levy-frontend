@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import sdil.config.AppConfig
@import sdil.models.variations.VariationsSubmission
@import sdil.actions.VariationRequest
@import uk.gov.hmrc.play.views.html.helpers.form

@(f: Form[_], variationsSubmission: VariationsSubmission)(implicit request: VariationRequest[_], messages: Messages, config: AppConfig)

@main_template(Messages("sdil.registered.title")) {

    <a class="link-back" href="@sdil.controllers.variation.routes.VariationsController.show()">@Messages("sdil.common.back")</a>

    <h1>@Messages("sdil.variations.summary.title")</h1>
    <p>@Messages("sdil.variations.summary.p1")</p>

    @if(variationsSubmission.nonEmpty) {

        @if(variationsSubmission.tradingName.isDefined || variationsSubmission.businessContact.map(_.address).isDefined) {
            <p>@Messages("sdil.variations.business-details")</p>
        }
        @*
        new packaging sites
        @if(variationsSubmission.newSites.nonEmpty) {
            <p>@Messages("sdil.variations.production-sites.new")</p>
        }

        @*should we use amend sites?
        @if(variationsSubmission.amendSites.nonEmpty) {
            <p>@Messages("sdil.variations.production-sites.amend")</p>
        }

        @*close packaging sites
        @if(variationsSubmission.closeSites.nonEmpty) {
            <p>@Messages("sdil.variations.production-sites.close")</p>
        }

        @*change warehouse sites
        @if(request.data.original.warehouseSites != request.data.updatedWarehouseSites) {
            <p>@Messages("sdil.variations.warehouse-sites")</p>
        }
        *@
        @if(variationsSubmission.primaryPersonContact.nonEmpty) {
            <p>@Messages("sdil.variations.contact-details.change")</p>
        }

        @form(sdil.controllers.variation.routes.VariationsSummaryController.submit()) {
            @* @request.data match {
            case data if data.original.activity.voluntaryRegistration && data.isLiable => {
                <p>@Messages("sdil.variations.voluntary-to-mandatory")</p>
                @inputTextArea(f("variationReason"), "why the hell would you do that?")
            }
            case data if !data.original.activity.voluntaryRegistration && data.isVoluntary => {
                <p>@Messages("sdil.variations.mandatory-to-voluntary")</p>
                @inputTextArea(f("variationReason"), "why the hell would you do that?")
            }
            case data if !(data.isLiable || data.isVoluntary) => {
                <p>@Messages("sdil.variations.deregister")</p>
                @inputTextArea(f("variationReason"), "why the hell would you deregister?")
            }
            case _ if variationsSubmission.sdilActivity.nonEmpty => {
                <p>@Messages("you changed a thing")</p>
                @inputTextArea(f("variationReason"), "why the hell would you do that?")
            }
            case _ => {}
            }
            *@
            <p><input class="button" value="@Messages("sdil.variations.submit")" type="submit"></p>
        }
    } else {
        @Messages("sdil.variations.no-changes")
    }
}

@inputTextArea(field: Field, labelKey: String) = {
    <div class="form-group @if(field.hasErrors) {form-group-error}">
        <label for="@field.name">
            <span class="form-label">@Messages(labelKey)</span>
            @field.errors.map { error =>
                <span class="error-message" role="tooltip" data-journey="search-page:error:@field.name">
                @Messages(error.message, error.args: _*)
                </span>
            }
        </label>
        <textarea class="form-control form-control-3-4 @if(field.hasErrors) {form-control-error}"
        id="@field.name"
        name="@field.name"
        value="@field.value"
        rows="5"></textarea>
    </div>

}
