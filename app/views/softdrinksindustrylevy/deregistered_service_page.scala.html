@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import sdil.models.Address
@import sdil.models.retrieved.RetrievedSubscription
@import sdil.models.ReturnPeriod
@import sdil.models.SdilReturn
@import sdil.config.AppConfig
@import views.html.softdrinksindustrylevy.helpers._

@(address: Address, sdilReference: String, subscription: RetrievedSubscription, periodsDue: List[ReturnPeriod] = Nil, lastReturn: Option[SdilReturn], balance: BigDecimal, pendingDereg: Option[SdilReturn], variableReturns: List[ReturnPeriod])(implicit request: Request[_], messages: Messages, config: AppConfig)

@main_template(Messages("sdil.registered.title"), noArticle = true) {
    <div class="grid-row">
        <div class="column-two-thirds">
            <h1 class="heading-large">@Messages("sdil.service-page.title")</h1>

            @subscription.deregDate.map { deregDate =>
                @if(pendingDereg.isEmpty) {
                    <div class="alert alert--info margin-bottom-30">
                        <h2 class="heading-medium no-margin">@Messages("sdil.service-page.deregistered.pending.title")</h2>
                        <p>@Messages("sdil.service-page.deregistered.pending.p1", ReturnPeriod(deregDate).start.format("MMMM yyyy"), ReturnPeriod(deregDate).end.format("MMMM yyyy"), ReturnPeriod(deregDate).next.start.format("d MMMM"), ReturnPeriod(deregDate).deadline.format("d MMMM yyyy"))</p>
                        <p>@Messages("sdil.service-page.deregistered.pending.p2")</p>
                        <p>@Messages("sdil.service-page.deregistered.pending.p3")</p>
                    </div>
                    @for(period <- periodsDue.take(1)) {
                        @if(period.end.isAfter(deregDate)) {
                            <h2 class="heading-medium no-margin">@Messages("returnsHome.dereg.final-return-title")</h2>
                            <p>
                            @Messages(
                                "returnsHome.dereg.final-return-p1",
                                period.start.format("MMMM yyyy"),
                                period.end.format("MMMM yyyy")
                            )
                            </p>
                            <div>
                            @details("returnsHome.help.title") {
                                <p>@Messages("returnsHome.help.p1")</p>
                                <ul class="list list-bullet">
                                    <li>@Messages("returnsHome.help.li1")</li>
                                    <li>@Messages("returnsHome.help.li2")</li>
                                    <li>@Messages("returnsHome.help.li3")</li>
                                    <li>@Messages("returnsHome.help.li4")</li>
                                </ul>
                                <p>@Messages("returnsHome.help.p2")</p>
                                <p>@Messages("returnsHome.help.p3")</p>
                                <ul class="list list-bullet">
                                    <li>@Messages("returnsHome.help.li5")</li>
                                    <li>@Messages("returnsHome.help.li6")</li>
                                </ul>
                                <p>@Html(Messages("returnsHome.help.guidance", Messages("returnsHome.help.guidance.link")))</p>
                            }
                            </div>
                            <div>
                                <a href='@sdil.controllers.routes.ReturnsController.index(period.year, period.quarter, "own-brands-packaged-at-own-sites")' class="button">
                                @Messages("return.file")
                                </a>
                            </div>
                        }
                    }
                } else {
                    <div class="alert alert--info margin-bottom-30">
                        <h2 class="heading-medium no-margin">@Messages("returnsHome.dereg.title")</h2>
                        <p>@Messages("returnsHome.dereg.p1", deregDate.format("dd MMMM yyyy"), deregDate.plusYears(7).format("dd MMMM yyyy"))</p>
                    </div>
                }
            }
            </div>
    </div>
}