@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import sdil.models.Address
@import views.html.softdrinksindustrylevy.helpers._
@import uk.gov.hmrc.play.views.html.helpers._
@import sdil.config.AppConfig

@(siteForm: Form[_],
        bprAddress: Address,
        primaryPlaceOfBusiness: Option[Address],
        otherSites: Seq[Address],
        backLink: Call
)(implicit request: Request[_], messages: Messages, config: AppConfig)

@main_template(Messages("sdil.common.title")) {

    <a class="link-back" href="@backLink.url">@Messages("sdil.common.back")</a>

    <h1 class="heading-large">@Messages("sdil.productionSite.heading")</h1>

    @errorSummary(Messages("sdil.common.errorSummary"), siteForm)

    @form(sdil.controllers.routes.ProductionSiteController.submit()) {

        <fieldset>
            <div class="form-group">
                <span class="form-hint">@Messages("sdil.production-sites.select-applicable")</span>

                @addressCheckbox("bprAddress", bprAddress)

                @primaryPlaceOfBusiness.map { ppob =>
                    @addressCheckbox("ppobAddress", ppob)
                }

                @*avoid duplicating bpr address/ppob address*@
                @otherSites.filterNot(a => a == bprAddress || primaryPlaceOfBusiness.contains(a)).zipWithIndex.map { case (site, idx) =>
                    @addressCheckbox(s"additionalSites[$idx]", site)
                }

                <div class="multiple-choice" data-target="add_address_lines">
                    <input type="checkbox"
                           id="add_address"
                           name="addAddress"
                           value="true"
                           @if(siteForm("addAddress").value.contains("true")) { checked="checked" }>

                    <label for="add_address">
                        @Messages("label.production-sites.add")
                    </label>
                </div>

                <div class="panel panel-border-narrow js-hidden" id="add_address_lines">
                    @addressFields(siteForm, "additionalAddress", "sdil.production-site.add")

                    <br/>
                    @* note that nested forms are not allowed in HTML, so both buttons must use the same action *@
                    <input class="button button-secondary" value="@Messages("sdil.production-site.add")" type="submit">
                </div>
            </div>
        </fieldset>

        <details role="group">
            <summary role="button" aria-controls="details-content-0">
                <span class="summary">@Messages("sdil.production-site.help.summary")</span>
            </summary>
            <div class="panel panel-border-narrow" id="details-content-0">
                <p>@Messages("sdil.production-site.help.p1")</p>
                <p>@Messages("sdil.production-site.help.p2")</p>
            </div>
        </details>

        <p>@Messages("sdil.production-site.adding-multiple-sites")</p>

        <input class="button" value="@Messages("sdil.common.save-continue")" type="submit">
    }
}

@addressCheckbox(name: String, address: Address) = {
    <div class="multiple-choice">
        <input type="checkbox" id="@name" name="@name" value="@address.nonEmptyLines.mkString(",")" checked="checked">
        <label for="@name">
            <div>@address.line1, @address.line2,</div>
            <div>@if(address.line3.nonEmpty) { @address.line3, } @if(address.line4.nonEmpty) { @address.line4, }@address.postcode</div>
        </label>
    </div>
}
